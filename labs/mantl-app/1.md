# Mantl: Deploying a microservices application

# Objective

This learning lab will help you understand the general concepts of deploying a containerized, microservices application into Mantl.

Completion time: 30 minutes

# Audience

* Application developers
* DevOps engineers

# Prerequisites

* Git client
* Access to the Cisco DevNet Mantl Sandbox (https://mantlsandbox.cisco.com/ui)

# What is Mantl?

Mantl is a package of popular Cloud Native systems, such as Mesos and Marathon for container scheduling and management.  Rather than spending weeks getting your infrastructure up-and-running, you can use the Mantl installer to install and configure a Mantl cluster.  

# What is a containerized app?

A container is essentially a way to package your entire application stack into a self-contained unit.  While containers have existed for a while, Docker has made it easy and popularized the concept.  When using Docker, you will find that your containers are essentially versioned.

An example of the `docker images` command that shows you two repositories and which tag (or version) has been made available on Docker Hub.  Docker Hub is a way to share containers over the internet.

```
REPOSITORY                            TAG                 IMAGE ID            CREATED             SIZE
node                                  5.11.1              6300cb2bfbd4        2 weeks ago         647.6 MB
alpine                                latest              14e13b07dc83        4 weeks ago         4.797 MB
```

# What is a microservices architecture?

A microservices architecture is an application that is broken down into its components.  For example, you may have several API services that make up a blog service.  You might have a User API, Content API, and a UI service.  Rather than building your application in a single container/binary/package, you would break these APIs and the UI service into multiple containers.

# The My Hero app

In this learning lab, you will be using an example application that has been designed using microservices patterns.  

The application provides a simple interface for gathering and reporting votes about the best movie superheros.

The application is built in a microservice style wrapping each service in a docker container that can be deployed and run in Mantl. In its initial form the applicaiton has three services.

* [myhero/data](https://github.com/hpreston/myhero_data) - This service stores all the data about candidates and votes cast.
* [myhero/app](https://github.com/hpreston/myhero_app) - This service provides the basic logic layer for accessing and recording votes.
* [myhero/web](https://github.com/hpreston/myhero_web) - This is the main user interface for casting votes.

# Deploying the My Hero app

1. Start by cloning the repository for the application using the Git command-line interface:

```shell
$ git clone https://github.com/hpreston/myhero_demo.git
Cloning into 'myhero_demo'...
remote: Counting objects: 225, done.
remote: Total 225 (delta 0), reused 0 (delta 0), pack-reused 225
Receiving objects: 100% (225/225), 1.69 MiB | 534.00 KiB/s, done.
Resolving deltas: 100% (142/142), done.
Checking connectivity... done.
```

2. Change directory into the newly cloned directory:

```shell
$ cd myhero_demo
```

3. Ensure that you're using the correct version of the respository:

```shell
$  git checkout 6bcd5ed
Note: checking out '6bcd5ed'.

You are in 'detached HEAD' state. You can look around, make experimental
changes and commit them, and you can discard any commits you make in this
state without impacting any branches by performing another checkout.

If you want to create a new branch to retain commits you create, you may
do so (now or later) by using -b with the checkout command again. Example:

  git checkout -b <new-branch-name>

HEAD is now at 6bcd5ed... Fixed deployment of direct mode app.
```

4. Prepare your local environment:

```shell
$ source myhero_setup
```

# Reset

* Run reset script

# Conclusion

* You've seen how deploy w/ Marathon API
* As a result, you can automate this with a Continuous Integration system
* You can also do things like blue/green
