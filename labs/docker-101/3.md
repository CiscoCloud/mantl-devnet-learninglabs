# Building a Docker Image

Next we'll build our own Ubuntu Docker image instead of using the one from DockerHub.

1. Downloading the Ubuntu Dockerfile and its dependencies.  
   ```
   git clone --single-branch --branch dist-amd64 https://github.com/tianon/docker-brew-ubuntu-core.git
   ```

2. Change directory to the cloned repository and ensure that the Dockerfile is present.  
   ```
   cd docker-brew-ubuntu-core/xenial
   ls .
   ```  

3. Build a new image using Docker and the Dockerfile.  
   ```
   docker build .
   ```  

   Docker prints progress messages as it builds the Ubuntu image. Once it finishes building the image, Docker assigns it a randomly-chosen name.

4. Run the command `docker images`.
   Docker lists all the images on your system, including both the newly-built one and any that you previously downloaded. You can tell which image is the one you just created by examining the list; it's the only image that isn't associated with a repository:  
      ![Docker Images](assets/images/images1.png)

5. Run the newly created docker image by giving the randomly-chosen ID to Docker:
   ```
   docker run -ti <your image ID>
   ```  
   The newly-created image behaves exactly the same way as the Ubuntu image from Dockerhub because was built from the same Dockerfile. You now have a bash root prompt.
   
 6. Enter ``ls`` to confirm standard Ubuntu directories are installed.

# Building a Custom Cisco Learning Labs Container

To modify the image that we just built, all we have to do is change the Dockerfile and ensure that any needed resources are available in the repository. Let's make an image that's more specific to our application's needs.

Let's change the image to display the following message:

    ```
    Hello from DevNet!
    ```

To make the image display that message we will:

1. Create a new Python script.  

2. Edit the Dockerfile to include that script in the container build.  

3. Change the Dockerfile to install python in the container (remember, all dependencies must be present in the container).  

4. Build and test the new container.  


To update the image, perform any of the following methods:

* Copy and paste following Dockerfile commands.
* Type the commands into the Docker file manually.
* Clone the Github repository that contains the files.

1. Clone the Github repository that contains the Dockerfile for this section using the following command:

     ```
    git clone https://github.com/CiscoDevNet/container-intro-devnet.git
    cd container-intro-devnet
    ```

   The cloned repository contains two files:

   * hellodevnet.py
   * Dockerfile

   The "hellodevnet.py" file is our custom application. It contains the following Python code:

     ``` python
      #!/usr/bin/env python
      print("Hello from DevNet!")
     ```

   The Dockerfile contains the instructions required to build the custom image:

    ```
    FROM ubuntu
    RUN apt-get update
    RUN apt-get -y install python
    ADD hellodevnet.py /hellodevnet.py
    COPY hellodevnet.py /hellodevnet.py
    RUN ["chmod", "+x", "/hellodevnet.py"]
    CMD ["/hellodevnet.py"]
    ```

   This Dockerfile says:

   1. `FROM ubuntu`  
    Extend the existing ubuntu public docker image. Our previous examples built an image from scratch. In this case we begin with a previously-built container image and           extend with our own customisations.

  2. `RUN apt-get update`  
   Ensure the package-management tools in the base Ubuntu container are updated to use the latest software.

  3. `RUN apt-get -y install python`  
   Use apt-get to install Python and all its dependencies in the container. The reason to build this container on an existing Ubuntu image is that we could use apt-get to install needed software.

  4. `ADD hellodevnet.py /hellodevnet.py`  
   Copy our Python program from the local directory into the container as `/hellodevnet.py`.
   
  5. `COPY hellodevnet.py /hellodevnet.py`

  6. `RUN ["chmod", "+x", "/hellodevnet.py"]`
    

  7. `CMD ["/hellodevnet.py"]`  
   Run our Python program when the container starts up.
   
2. Build the docker image using the following command:

    ```
    docker build .
    ```

 ![Custom Docker Build](assets/images/dockerbuildcustom.png)

3. Run the new container using the following command:
    ```
    Run <Container ID>
    ```
    The "Hello from DevNet!" message is displayed in the container terminal.

Congratulations, you've just built and run a custom docker image!

Now let's build a container image that does something more useful: how about a container that runs a web server?
